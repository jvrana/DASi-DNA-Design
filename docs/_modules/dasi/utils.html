<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>dasi.utils &#8212; dasi 0.0.18 documentation</title>
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/style.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js "></script>

  </head><body>



  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          DASi</a>
        <span class="navbar-text navbar-version pull-left"><b>0.0.18</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">DASi <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../usage.html">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../usage.html#getting-started">Getting started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#installation">Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#running-examples">Running examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../usage.html#advanced">Advanced</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#using-inventory-information-with-dasi">Using inventory information with DASi</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage.html#adjusting-design-parameters">Adjusting design parameters</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../schemas/schemas.html">JSON Schemas</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../schemas/schemas.html#default-cost-parameters">Default Cost Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../schemas/schemas.html#cost-parameter-schema">Cost Parameter Schema</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../schemas/schemas.html#cost-parameters-schema">Cost Parameters Schema</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../schemas/schemas.html#design-output-schema">Design Output Schema</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../schemas/schemas.html#dasi-design-output">DASi design output</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../design.html">Design (<code class="xref py py-mod docutils literal notranslate"><span class="pre">dasi.design</span></code>)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../generated/dasi.design.Design.html">dasi.design.Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../generated/dasi.design.LibraryDesign.html">dasi.design.LibraryDesign</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../generated/dasi.design.DesignResult.html">dasi.design.DesignResult</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../models.html">Models (<code class="xref py py-mod docutils literal notranslate"><span class="pre">dasi.models</span></code>)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../generated/dasi.models.Assembly.html">dasi.models.Assembly</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../generated/dasi.models.AssemblyNode.html">dasi.models.AssemblyNode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../generated/dasi.models.Molecule.html">dasi.models.Molecule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../generated/dasi.models.MoleculeType.html">dasi.models.MoleculeType</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../generated/dasi.models.Reaction.html">dasi.models.Reaction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../generated/dasi.models.AlignmentGroup.html">dasi.models.AlignmentGroup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../generated/dasi.models.AlignmentGroupBase.html">dasi.models.AlignmentGroupBase</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../generated/dasi.models.MultiPCRProductAlignmentGroup.html">dasi.models.MultiPCRProductAlignmentGroup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../generated/dasi.models.PCRProductAlignmentGroup.html">dasi.models.PCRProductAlignmentGroup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../generated/dasi.models.AlignmentContainer.html">dasi.models.AlignmentContainer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../generated/dasi.models.AlignmentContainerFactory.html">dasi.models.AlignmentContainerFactory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../models.html#modules">modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../generated/dasi.models.alignment.html">dasi.models.alignment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/dasi.models.alignment_container.html">dasi.models.alignment_container</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../cost.html">Cost Model (<code class="xref py py-mod docutils literal notranslate"><span class="pre">dasi.cost</span></code>)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../cost.html#utilities">Utilities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../generated/dasi.cost.utils.html">dasi.cost.utils</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../command_line.html">Command Line (<code class="xref py py-mod docutils literal notranslate"><span class="pre">dasi.command_line</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../utils.html">Utilities (<code class="xref py py-mod docutils literal notranslate"><span class="pre">dasi.utils</span></code>)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../utils.html#utility-modules">Utility modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../generated/dasi.utils.npdf.html">dasi.utils.npdf</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/dasi.utils.region.html">dasi.utils.region</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../utils.html#networkx-utilities">Networkx utilities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../generated/dasi.utils.networkx.exceptions.html">dasi.utils.networkx.exceptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/dasi.utils.networkx.shortest_path.html">dasi.utils.networkx.shortest_path</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../generated/dasi.utils.networkx.utils.html">dasi.utils.networkx.utils</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../exceptions.html">Exceptions (<code class="xref py py-mod docutils literal notranslate"><span class="pre">dasi.exceptions</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../constants.html">Constants (<code class="xref py py-mod docutils literal notranslate"><span class="pre">dasi.constants</span></code>)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../guidelines.html">Code Guidelines</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <h1>Source code for dasi.utils</h1><div class="highlight"><pre>
<span></span>r&quot;&quot;&quot;
Utilities (:mod:`dasi.utils`)
=============================

This module provide various utility functions.

.. currentmodule:: dasi.utils

Utility modules
---------------

.. autosummary::
    :toctree: generated/

    npdf
    region
    sequence_design

Networkx utilities
------------------

.. currentmodule:: dasi.utils.networkx

Specialized networkx algorithms for path and cycle finding.

.. autosummary::
    :toctree: generated/

    algorithsm
    exceptions
    shortest_path
    utils

&quot;&quot;&quot;
import bisect
import inspect
from copy import deepcopy
from datetime import datetime
from functools import wraps
from itertools import tee
from typing import Any
from typing import Callable
from typing import Iterable
from typing import List
from typing import Tuple
from typing import TypeVar
from typing import Union

from .networkx.shortest_path import multipoint_shortest_path
from .networkx.utils import sort_cycle
from .npdf import NumpyDataFrame
from .npdf import NumpyDataFrameException
from .region import Region


<div class="viewcode-block" id="sort_with_keys"><a class="viewcode-back" href="../../utils.html#dasi.utils.sort_with_keys">[docs]</a>def sort_with_keys(a: Iterable[Any], key: Callable) -&gt; Tuple[List, List]:
    &quot;&quot;&quot;Sort an iterable, returning both the sorted array and the sorted keys.

    :param a: the iterable
    :param key: key function to use for sorting
    :return:
    &quot;&quot;&quot;
    s = sorted(a, key=key)
    keys = [key(x) for x in s]
    return s, keys</div>


<div class="viewcode-block" id="bisect_between"><a class="viewcode-back" href="../../utils.html#dasi.utils.bisect_between">[docs]</a>def bisect_between(a: Iterable, low: Any, high: Any) -&gt; Tuple[int, int]:
    &quot;&quot;&quot;Returns the start (inclusive) and end (exclusive) indices for a sorted
    array using a key function.

    :param a: sorted array (does not check)
    :param low: low key
    :param high: high key
    :return: tuple of start (inclusive) and end (exclusive) indices
    &quot;&quot;&quot;
    i = bisect.bisect_left(a, low)
    j = bisect.bisect_right(a[i:], high)
    return i, j + i</div>


<div class="viewcode-block" id="bisect_slice_between"><a class="viewcode-back" href="../../utils.html#dasi.utils.bisect_slice_between">[docs]</a>def bisect_slice_between(a: Iterable, keys: Iterable, low: Any, high: Any) -&gt; Iterable:
    &quot;&quot;&quot;Slice the iterable using inclusive bisection. Assumes both the iterable
    and keys are sorted. Bisect at specified `low` and `high`.

    :param a: pre-sorted iterable to slice
    :param keys: pre-sorted keys to bisect
    :param low: low key
    :param high: high key
    :return: sliced iterable
    &quot;&quot;&quot;
    i, j = bisect_between(keys, low, high)
    return a[i:j]</div>


<div class="viewcode-block" id="perfect_subject"><a class="viewcode-back" href="../../utils.html#dasi.utils.perfect_subject">[docs]</a>def perfect_subject(data):
    &quot;&quot;&quot;Determine whether a blast result consumes the entire subject.&quot;&quot;&quot;
    if data[&quot;strand&quot;] == 1 and data[&quot;start&quot;] == 1 and data[&quot;raw_end&quot;] == data[&quot;length&quot;]:
        return True
    elif (
        data[&quot;strand&quot;] == -1
        and data[&quot;raw_end&quot;] == 1
        and data[&quot;start&quot;] == data[&quot;length&quot;]
    ):
        return True</div>


def prep_df(df):
    colnames = [
        &quot;DESIGN_ID&quot;,
        &quot;DESIGN_KEY&quot;,
        &quot;ASSEMBLY_ID&quot;,
        &quot;REACTION_ID&quot;,
        &quot;NAME&quot;,
        &quot;TYPE&quot;,
        &quot;KEY&quot;,
        &quot;ROLE&quot;,
        &quot;REGION&quot;,
        &quot;SEQUENCE&quot;,
        &quot;LENGTH&quot;,
        &quot;META&quot;,
    ]
    df.columns = colnames
    df.sort_values(by=[&quot;TYPE&quot;, &quot;DESIGN_ID&quot;, &quot;REACTION_ID&quot;, &quot;ASSEMBLY_ID&quot;, &quot;ROLE&quot;])
    return df


<div class="viewcode-block" id="group_by"><a class="viewcode-back" href="../../utils.html#dasi.utils.group_by">[docs]</a>def group_by(arr: List[Any], key: Callable):
    &quot;&quot;&quot;Group a list by some key.&quot;&quot;&quot;
    grouped = {}
    for x in arr:
        k = key(x)
        grouped.setdefault(k, list())
        grouped[k].append(x)
    return grouped</div>


def now():
    return datetime.now()


<div class="viewcode-block" id="log_times"><a class="viewcode-back" href="../../utils.html#dasi.utils.log_times">[docs]</a>def log_times(key: str = None, class_attribute: str = &quot;_method_trace&quot;):
    &quot;&quot;&quot;wrapper for logging method run times for a class.&quot;&quot;&quot;

    def wrapped(f):
        @wraps(f)
        def _wrapped(self, *args, **kwargs):

            if not hasattr(self, class_attribute):
                raise ValueError(
                    &quot;Instance {} must have attribute &#39;{}&#39;&quot;.format(self, class_attribute)
                )
            elif not isinstance(getattr(self, class_attribute), dict):
                raise ValueError(
                    &quot;Attribute {} of {} must be a {}&quot;.format(
                        class_attribute, self, dict
                    )
                )
            t1 = now()
            result = f(self, *args, **kwargs)
            t2 = now()

            if key is None:
                use_key = f.__name__
            else:
                use_key = key
            getattr(self, class_attribute)[use_key] = (t1, t2)
            return result

        return _wrapped

    return wrapped</div>


def fmt_datetime(t):
    return str(t)


<div class="viewcode-block" id="log_metadata"><a class="viewcode-back" href="../../utils.html#dasi.utils.log_metadata">[docs]</a>def log_metadata(
    key: str = None,
    class_attribute: str = &quot;_method_trace&quot;,
    additional_metadata: dict = None,
):
    &quot;&quot;&quot;wrapper for logging method run times for a class.&quot;&quot;&quot;

    def wrapped(f):
        @wraps(f)
        def _wrapped(self, *args, **kwargs):

            if not hasattr(self, class_attribute):
                raise ValueError(
                    &quot;Instance {} must have attribute &#39;{}&#39;&quot;.format(self, class_attribute)
                )
            elif not isinstance(getattr(self, class_attribute), dict):
                raise ValueError(
                    &quot;Attribute {} of {} must be a {}&quot;.format(
                        class_attribute, self, dict
                    )
                )
            t1 = now()
            result = f(self, *args, **kwargs)
            t2 = now()

            argspec = inspect.getfullargspec(f)

            copied_args = deepcopy(args)
            copied_kwargs = deepcopy(kwargs)
            argdict = dict(zip(argspec.args[1:], copied_args))
            argdict.update(copied_kwargs)

            metadata = {
                &quot;__name__&quot;: f.__name__,
                &quot;__spec__&quot;: str(argspec),
                &quot;start&quot;: fmt_datetime(t1),
                &quot;end&quot;: fmt_datetime(t2),
                &quot;args&quot;: argdict,
            }
            if additional_metadata:
                metadata.update(additional_metadata)

            if key is None:
                use_key = f.__name__
            else:
                use_key = key
            getattr(self, class_attribute)[use_key] = metadata
            return result

        return _wrapped

    return wrapped</div>


T = TypeVar(&quot;T&quot;)


def argsorted(
    arr: Iterable[T], key: Callable, return_items: bool = False
) -&gt; Union[List[Tuple[int, T]], List[T]]:
    s = sorted(enumerate(tee(arr)[0]), key=lambda x: key(x[1]))
    if return_items:
        return s
    else:
        return [_s[0] for _s in s]
</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2017-2019, University of Washington.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>